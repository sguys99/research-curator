# Day 8 Checkpoint 2: AI 챗봇 온보딩 페이지

## 📋 체크포인트 개요

**목표**: AI 챗봇과 대화하며 초기 설정을 완료하는 온보딩 페이지 구현

**구현 시간**: ~3시간
**상태**: ✅ 완료

---

## 🎯 구현 항목

### 1. 챗봇 컴포넌트 (`components/chatbot.py`)

**OnboardingChatbot 클래스** - 380+ lines

**주요 메서드 (19개):**

**초기화 및 렌더링:**
- `__init__()` - 챗봇 초기화
- `_init_session_state()` - 세션 상태 초기화
- `render()` - 챗봇 UI 렌더링
- `_display_messages()` - 대화 메시지 표시
- `_render_options()` - 선택지 버튼 렌더링

**입력 처리:**
- `_handle_user_input()` - 사용자 텍스트 입력 처리
- `_handle_option_selected()` - 옵션 버튼 클릭 처리
- `_process_response()` - 사용자 응답 처리 및 다음 질문

**정보 추출 (5개):**
- `_extract_research_fields()` - 연구 분야 추출
- `_extract_keywords()` - 키워드 추출
- `_extract_info_types()` - 정보 유형 비율 추출
- `_extract_sources()` - 추가 소스 추출
- `_extract_email_settings()` - 이메일 설정 추출

**질문 단계 (5개):**
- `_ask_keywords()` - 키워드 질문
- `_ask_info_types()` - 정보 유형 질문
- `_ask_sources()` - 소스 질문
- `_ask_email_settings()` - 이메일 설정 질문
- `_ask_confirmation()` - 확인 질문

**완료 처리:**
- `_show_welcome_message()` - 환영 메시지
- `_show_completion_message()` - 완료 메시지 및 저장 버튼
- `_save_preferences()` - UserPreference 저장

---

### 2. 대화 플로우 (5단계)

#### Step 0: 환영 메시지
```
안녕하세요! 👋

저는 Research Curator의 AI 어시스턴트입니다.
몇 가지 질문을 통해 맞춤형 리서치 큐레이션을 설정해드리겠습니다.

질문은 5가지이며, 각 질문에 답변해주시면 자동으로 설정이 완료됩니다.

준비되셨나요? 😊
```

#### Step 1: 연구 분야
```
질문 1/5: 어떤 연구 분야에 관심이 있으신가요?

예시: Machine Learning, Natural Language Processing, Computer Vision 등
```

**정보 추출 로직:**
- 쉼표 및 공백으로 분리
- 최대 5개 분야까지 저장
- 기본값: ["AI", "Machine Learning"]

#### Step 2: 키워드
```
질문 2/5: 특히 관심있는 키워드를 알려주세요.

예시: transformer, GPT, BERT, attention mechanism, transfer learning 등
```

**정보 추출 로직:**
- 쉼표 및 공백으로 분리
- 최대 10개 키워드까지 저장
- 기본값: ["AI", "research"]

#### Step 3: 정보 유형
```
질문 3/5: 어떤 유형의 정보를 받고 싶으신가요?

선택지:
- 📚 논문 위주 (70%)
- 📰 뉴스 위주 (70%)
- 📊 리포트 위주 (70%)
- ⚖️ 균형있게 (논문 50%, 뉴스 30%, 리포트 20%)
```

**정보 추출 로직:**
- "논문" → `{"paper": 0.7, "news": 0.2, "report": 0.1}`
- "뉴스" → `{"paper": 0.2, "news": 0.7, "report": 0.1}`
- "리포트" → `{"paper": 0.2, "news": 0.1, "report": 0.7}`
- 기본값 → `{"paper": 0.5, "news": 0.3, "report": 0.2}`

#### Step 4: 추가 소스
```
질문 4/5: 특별히 포함하고 싶은 웹사이트가 있나요?

예시: techcrunch.com, venturebeat.com 등

없으면 "없음" 또는 "기본"이라고 답변해주세요.
```

**정보 추출 로직:**
- "." 포함된 단어만 추출
- 최대 5개 소스까지 저장
- "없음", "기본" → 빈 리스트

#### Step 5: 이메일 설정
```
질문 5/5: 이메일 설정을 선택해주세요.

선택지:
- 🕗 오전 8시 (기본)
- 🕐 오후 1시
- 🕕 오후 6시
- 🕘 오후 9시
```

**정보 추출 로직:**
- "오전 8시" → "08:00"
- "오후 1시" → "13:00"
- "오후 6시" → "18:00"
- "오후 9시" → "21:00"

#### Step 6: 확인
```
완벽합니다! 🎉

설정이 완료되었습니다. 확인해주세요:

연구 분야: Machine Learning, NLP
키워드: transformer, GPT, BERT
정보 유형: 논문 70%, 뉴스 20%, 리포트 10%
이메일 발송 시간: 08:00
일일 제공량: 5개

이대로 저장하시겠습니까?

"확인" 또는 "수정"을 입력해주세요.
```

---

### 3. 세션 상태 관리

**수집된 정보 구조:**
```python
{
    "research_fields": ["Machine Learning", "NLP"],
    "keywords": ["transformer", "GPT", "BERT"],
    "info_types": {"paper": 0.7, "news": 0.2, "report": 0.1},
    "sources": ["techcrunch.com"],
    "email_time": "08:00",
    "daily_limit": 5,
}
```

**Streamlit 세션 상태:**
- `chat_messages` - 대화 메시지 히스토리
- `chat_step` - 현재 진행 단계 (0-7)
- `collected_info` - 수집된 사용자 정보

---

### 4. 온보딩 페이지 (`pages/onboarding.py`)

**주요 기능:**

1. **페이지 헤더**
   - 그라데이션 배경
   - 환영 메시지
   - 3개 정보 카드 (소요 시간, 질문 수, 맞춤 설정)

2. **챗봇 표시**
   - `show_onboarding_chatbot()` 호출
   - 전체 대화 플로우 처리

3. **사이드바 도움말**
   - 온보딩 진행 방법
   - 팁 및 안내

**UI 구성:**
```
┌─────────────────────────────────┐
│  🚀 환영합니다!                  │
│  AI 어시스턴트가 맞춤형 설정을   │
│  도와드립니다                    │
└─────────────────────────────────┘

┌────────┬────────┬────────┐
│⏱️ 2-3분│💬 5질문│🎯 맞춤 │
└────────┴────────┴────────┘

───────────────────────────

💬 [챗봇 대화 영역]

[메시지 입력창]
```

---

### 5. 설정 저장

**API 호출:**
```python
api.update_user_preferences(user_id, {
    "research_fields": [...],
    "keywords": [...],
    "sources": [...],
    "info_types": {...},
    "email_time": "08:00",
    "daily_limit": 5,
    "email_enabled": True,
})
```

**완료 후 처리:**
1. `mark_onboarding_completed()` - 온보딩 완료 표시
2. `st.rerun()` - 대시보드로 자동 이동

---

## 🎨 UI/UX 특징

### 1. 대화형 인터페이스
- `st.chat_message()` 사용
- 사용자/어시스턴트 메시지 구분
- 자연스러운 대화 플로우

### 2. 선택지 버튼
- 일부 질문에 버튼 제공
- 클릭만으로 응답 가능
- 사용자 편의성 향상

### 3. 진행 상태 표시
- "질문 N/5" 형식
- 현재 단계 명확히 표시

### 4. 수집 정보 확인
- 마지막 단계에서 요약 표시
- 수정 기회 제공

### 5. 디버그 모드
- 수집된 정보 실시간 확인 (개발용)
- `debug_mode` 세션 상태로 제어

---

## ✅ 테스트 및 검증

### 테스트 노트북

**`notebooks/08.test_day8_checkpoint2.ipynb`**

**테스트 항목:**
1. ✅ 파일 구조 확인 (3개 파일)
2. ✅ 챗봇 컴포넌트 메서드 확인 (19개)
3. ✅ 대화 플로우 시뮬레이션 (5단계)
4. ✅ 정보 추출 로직 테스트
5. ✅ 온보딩 페이지 함수 확인
6. ✅ 설정 저장 payload 구조 확인

**모든 테스트 통과!**

---

## 🚀 실행 방법

### 1. Streamlit 앱 실행

```bash
streamlit run src/app/frontend/main.py
```

### 2. 로그인

매직 링크 또는 토큰으로 로그인

### 3. 온보딩 시작

- 자동으로 온보딩 페이지로 이동
- AI 챗봇과 대화 시작

### 4. 5단계 질문 응답

1. 연구 분야 입력
2. 키워드 입력
3. 정보 유형 선택
4. 추가 소스 입력 (선택)
5. 이메일 시간 선택

### 5. 확인 및 저장

- 요약 정보 확인
- "확인" 입력
- 설정 저장 버튼 클릭

### 6. 대시보드 이동

자동으로 대시보드로 이동

---

## 📸 예상 UI 플로우

### 1. 환영 화면
```
🚀 환영합니다!
AI 어시스턴트가 맞춤형 설정을 도와드립니다

[⏱️ 2-3분] [💬 5질문] [🎯 맞춤]

───────────────────────────

💬 안녕하세요! 👋
...
```

### 2. 질문 1 - 연구 분야
```
💬 질문 1/5: 어떤 연구 분야에 관심이 있으신가요?

👤 Machine Learning, NLP

💬 좋아요! Machine Learning, NLP 분야군요.
```

### 3. 질문 3 - 정보 유형 (버튼)
```
💬 질문 3/5: 어떤 유형의 정보를 받고 싶으신가요?

[📚 논문 위주] [📰 뉴스 위주] [📊 리포트 위주]
[⚖️ 균형있게]
```

### 4. 확인 단계
```
💬 완벽합니다! 🎉

설정이 완료되었습니다. 확인해주세요:

연구 분야: Machine Learning, NLP
키워드: transformer, GPT, BERT
...

👤 확인

──────────────────────────

[✅ 설정 저장 및 대시보드로 이동]
```

---

## 🎯 주요 성과

1. **완전한 대화형 온보딩 ✅**
   - 5단계 질문 플로우
   - 자연어 입력 처리
   - 선택지 버튼 지원

2. **정보 추출 로직 ✅**
   - 연구 분야 자동 파싱
   - 키워드 자동 추출
   - 정보 유형 매핑

3. **세션 상태 관리 ✅**
   - 대화 히스토리 유지
   - 수집 정보 실시간 업데이트
   - 단계별 진행 상태 추적

4. **UserPreference 저장 ✅**
   - API 연동
   - 에러 처리
   - 완료 후 자동 이동

5. **사용자 친화적 UI ✅**
   - 직관적인 대화 인터페이스
   - 진행 상태 명확히 표시
   - 선택지 버튼으로 편의성 향상

---

## 🐛 개선 사항

### 현재 구현

**Simple Extraction:**
- 단순 문자열 파싱
- 쉼표/공백 기반 분리
- 키워드 매칭

**향후 개선 가능:**
- LLM 기반 정보 추출 (더 정확한 파싱)
- 자연어 이해 강화
- 대화 컨텍스트 유지

### LLM 통합 (선택사항)

현재는 룰 기반 추출이지만, 향후 `chat_completion` API를 사용하여:
- 더 자연스러운 대화
- 정확한 정보 추출
- 맥락 이해

---

## 📝 다음 단계 (Checkpoint 3)

**목표**: Dashboard, Search, Settings 페이지 구현

**구현 항목:**

1. **Dashboard 페이지** (`pages/1_dashboard.py`)
   - 최근 받은 이메일 미리보기
   - 통계 요약 (총 아티클, 평균 피드백 등)
   - 빠른 액션 (테스트 이메일 발송)

2. **Search 페이지** (`pages/2_search.py`)
   - 자연어 검색 입력
   - 필터링 옵션 (source_type, category, importance)
   - 검색 결과 표시 (카드 형식)
   - 유사 문서 추천

3. **Settings 페이지** (`pages/3_settings.py`)
   - 연구 분야/키워드 편집
   - 소스 추가/삭제
   - 정보 유형 비율 조정
   - 이메일 설정 변경
   - 저장 버튼

**예상 소요 시간**: 4-5시간

---

## 📊 체크포인트 요약

| 항목 | 상태 | 비고 |
|------|------|------|
| 챗봇 컴포넌트 | ✅ | OnboardingChatbot 클래스 |
| 온보딩 페이지 | ✅ | pages/onboarding.py |
| 5단계 대화 플로우 | ✅ | Welcome → 5 questions → Confirm |
| 정보 추출 로직 | ✅ | 5가지 필드 추출 |
| 세션 상태 관리 | ✅ | chat_messages, chat_step, collected_info |
| UserPreference 저장 | ✅ | API 연동 |
| UI/UX | ✅ | 대화형, 버튼, 진행 표시 |
| 테스트 노트북 | ✅ | 검증 완료 |

**전체 진행률**: ✅ 100% (Checkpoint 2 완료)

---

**작성일**: 2025-12-04
**작성자**: Claude Code
**상태**: ✅ 검증 완료
